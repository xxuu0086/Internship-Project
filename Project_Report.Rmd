---
title: |
  ETC5543 Business Analytics Creative Activity 
  
  Project Report
date:  "`r format(Sys.time(), '%d %B, %Y')`"
author:
  - Xianghe XU 
  
team: Group 1
subtitle: |
  Department of Econometrics and Business Statistics

  Monash University
  
  | - 
  
  __An investigation report on performance of probability-based panels compared to other methods.__
  
  | -
abstract: "The aim of this report..."
header-includes: 
  - \renewcommand{\and}{\\ \\}
  - \AddToHook{env/abstract/before}{\vspace*{2cm}}
  - \makeatletter\AddToHook{cmd/@date/before}{\vspace*{2cm}}\makeatother
output:
  bookdown::pdf_document2:
    toc: FALSE
    number_sections: TRUE
  html_document: default


---
\newpage

\newpage
\tableofcontents
\newpage

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  eval = TRUE,
  message = FALSE,  
  warning = FALSE,  
  error = FALSE,    
  out.width = "70%",
  fig.align = "center",
  fig.width = 8, 
  fig.height = 7,
  fig.retina = 3,
  fig.pos = "H", 
  out.extra = "")
```

```{r}
# Load packages and data
library(tidyverse)
library(haven)

dat <- haven::read_sav("../Data and survey materials/ACSSM Final Data_27-Feb-2023 weighted.sav")
```

```{r}
# Add column to indicate probability based and non-probability based
dat1 <- dat %>% 
  mutate(prob_based = ifelse(DataSource <= 5, "Probablity based", "Non-probablity based"))
```

```{r}
# distribution of page time for section 2, 4-9
dat1 %>% 
  # filter(Section_SUM_main < 120) %>% 
  ggplot(aes(x = as.factor(DataSource),
                   y = Section_SUM_main,
                   color = prob_based)) +
  geom_point() + 
  geom_violin() + 
  geom_hline(yintercept = 70 * 2 / 60, color = "purple", size = 1) +
  geom_text(aes(2,70 * 2 / 60, label = "`Cutoff` Time: 2.33 mins", vjust = 2), show.legend = FALSE, color = "purple") +
  scale_color_brewer(palette = "Set1") +
  theme_bw() +
  labs(x = "",
       y = "Total time for sections in minutes",
       color = "",
       title = "Distributions of time answering the survey questions for panels ")

dat1 %>% 
  filter(Section_SUM_main < 120) %>% 
  ggplot(aes(x = as.factor(DataSource),
                   y = Section_SUM_main,
                   color = prob_based)) +
  geom_point() + 
  geom_violin() + 
  geom_hline(yintercept = 70 * 2 / 60, color = "purple", size = 1) +
  geom_text(aes(2,70 * 2 / 60, label = "`Cutoff` Time: 2.33 mins", vjust = 2), show.legend = FALSE, color = "purple") +
  scale_color_brewer(palette = "Set1") +
  theme_bw() +
  labs(x = "",
       y = "Total time for sections in minutes",
       color = "",
       title = "Distributions of time answering the survey questions for panels ")

dat1 %>% 
  filter(Section_SUM_main < 120) %>% 
  ggplot(aes(x = as.factor(DataSource),
                   y = Section_SUM_main,
                   color = prob_based)) +
  geom_point() + 
  geom_violin() + 
  geom_hline(yintercept = 70 * 2 / 60, color = "purple", size = 1) +
  geom_text(aes(2,70 * 2 / 60, label = "`Cutoff` Time: 2.33 mins", vjust = 2), show.legend = FALSE, color = "purple") +
  scale_color_brewer(palette = "Set1") +
  theme_bw() +
  labs(x = "",
       y = "Total time for sections in minutes",
       color = "",
       title = "Distributions of time answering the survey questions for panels ")

```


```{r}
# page time
dat1 %>% select(DataSource,
               Section_Length_4:Section_Length_9,
               -Section_Length_8,
               prob_based) %>% 
  rowwise() %>% 
  mutate("ave" = sum(c(Section_Length_4,
                       Section_Length_5,
                       Section_Length_6,
                       Section_Length_7,
                       Section_Length_9), na.rm = TRUE) *60 /64) %>% 
  filter(ave > 0,
         ave < 2) %>% 
  group_by(DataSource) %>% 
  summarise(count = n()) %>% 
  mutate(DataSource = as.factor(DataSource)) %>% 
  mutate(prob_based = c("Probability based", "Probability based", "Probability based", "Non-Probability based", "Non-Probability based","Non-Probability based","Non-Probability based")) %>% 
  ggplot(aes(x = DataSource,
             y = count,
             fill = prob_based)) + 
  geom_col() + 
  theme_bw() +
  labs(x = "",
       y = "Total time for sections in minutes",
       fill = "",
       title = "Distributions of time answering the survey questions for panels ")
```
```{r}
# Percentage of item non-response
Item_non_response <- dat1 %>% 
  select(c(DataSource,
           GENDER:SUBURB,
           IMPPROB:INCOME,
           -IMPPROB_VERB,
           -GENDER_oth,
           -SUBURB,
           -VOTE_PARTY_oth,
           -HOMEOWNER_oth,
           -PANELREASON_oth,
           -HIGHEST_QUALIFICATION_oth,
           -COB_oth,
           -POSTCODE,
           -VOTE,
           -VOTE_PARTY,
           -EDU_CHECK,
           -HIGHEST_SCHOOLING,
           -FURTHER_EDU,
           -HIGHEST_QUALIFICATION,
           -VALI_LOCATION,
           -VALI_LOCATION_oth,
           -VALI_OVERHEAR,
           -VALI_FURTHER)) %>%
  as.data.frame() %>% 
  pivot_longer(GENDER:INCOME,
               names_to = "Question",
               values_to = "Answer") %>% 
  mutate(Answer = as.numeric(Answer)) %>% 
  mutate(Non_response = ifelse(Answer %in% c(-98, -99), 1, 0)) %>% 
  select(DataSource, Non_response) %>% 
  group_by(DataSource) %>% 
  summarise(Percentage = sum(Non_response) / n() * 100) %>% 
  mutate(prob_based = c("Probability based", "Probability based","Probability based", "Probability based", "Probability based",  "Non-Probability based", "Non-Probability based", "Non-Probability based","Non-Probability based"))

Item_non_response %>% 
  ggplot(aes(x = as.factor(DataSource),
             y = Percentage,
             fill = prob_based)) +
  geom_col() +
  theme_bw()
```

```{r}
# # Item non-response for variables ends with _99
# dat1 %>% select(DataSource,
#                 ends_with("_98"),
#                 ends_with("_99")) %>%
#   pivot_longer(HEALTHCON_98:RECONTACT2_99,
#                names_to = "Question",
#                values_to = "Answer") %>% 
#   na.omit() %>% 
#   
#   
#   select(DataSource, Answer) %>% 
#   group_by(DataSource) %>% 
#   summarise(Percentage = sum(Answer) / n() * 100) %>% 
#   ggplot(aes(x = as.factor(DataSource),
#              y = Percentage)) +
#   geom_col(fill = "#069AF3")
  
```

```{r}
# Straight lining
straight_lining <- dat1 %>% 
  select(DataSource,
         starts_with("K6_"),
         starts_with("TV_TIME_"),
         starts_with("INTERNET")) %>% 
  rowwise() %>% 
  mutate(K6_IER = ifelse(length(unique(c(K6_a,
                                         K6_b,
                                         K6_c,
                                         K6_d,
                                         K6_e,
                                         K6_f))) == 1, 1, 0)) %>% 
  mutate(TV_TIME_IER = ifelse(length(unique(c(TV_TIME_a,
                                              TV_TIME_b,
                                              TV_TIME_c,
                                              TV_TIME_d,
                                              TV_TIME_e,
                                              TV_TIME_f))) == 1, 1, 0)) %>% 
  mutate(INTERNET_IER = ifelse(length(unique(c(INTERNET_a,
                                              INTERNET_b,
                                              INTERNET_c,
                                              INTERNET_d))) == 1, 1, 0)) %>% 
  mutate(straight_lining = ifelse(sum(K6_IER, 
                                      TV_TIME_IER,
                                      INTERNET_IER) >= 2, 1, 0))

straight_lining %>% 
  select(DataSource, straight_lining) %>% 
  table()
```

```{r}
# dat %>% select(starts_with("TV_TIME")) %>% filter(TV_TIME_c == 6) %>% mutate("TOTAL" = TV_TIME_a+ TV_TIME_b+TV_TIME_c+ TV_TIME_d+ TV_TIME_e+ TV_TIME_f) %>% arrange(-TOTAL)

# Example code of mahalanobis 

# dat <- data.frame(ar = rnorm(200,1,2),
#                   be = rbinom(200,3,0.2),
#                   wo = runif(200))
# head(dat)
# S <- var(dat)
# mu <- colMeans(dat)
# D2 <- mahalanobis(dat,
#                   center = mu,
#                   cov = S)
```



# Introduction and Motivation
(include the readings)

# Survey quality metrics

# Data Description

# Chanllenges
- Understand the metrics
- matching the metrics to variables

# Preliminary Analysis

# Analysis

# Limitation

# Summary

\newpage

# Reference

__Citation of R package__

Wickham H, Averick M, Bryan J, Chang W, McGowan LD, François R, Grolemund G, Hayes A, Henry L, Hester J, Kuhn M, Pedersen TL,
  Miller E, Bache SM, Müller K, Ooms J, Robinson D, Seidel DP, Spinu V, Takahashi K, Vaughan D, Wilke C, Woo K, Yutani H (2019).
  “Welcome to the tidyverse.” _Journal of Open Source Software_, *4*(43), 1686. doi:10.21105/joss.01686
  <https://doi.org/10.21105/joss.01686>.
  
Xie Y (2023). _bookdown: Authoring Books and Technical Documents with R Markdown_. R
  package version 0.35, <https://github.com/rstudio/bookdown>.
  
\newpage

# Appendix: All code for this report

```{r ref.label=knitr::all_labels(), echo=TRUE, eval=FALSE}
```
