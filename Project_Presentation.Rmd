---
title: "ACSSM Data Quality Project"
subtitle: ETC5543 Business Analytics Creative Activity Presentation
author:
  - [Xianghe Xu]
date: "`r Sys.Date()`"
output:
  ioslides_presentation:
    incremental: true
    css: styles.css
    logo: Image/monash-university-vector-logo.png
    theme: cerulean
    center: true
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  eval = TRUE,
  message = FALSE, 
  warning = FALSE, 
  error = FALSE,  
  out.width = "65%",
  fig.width = 8, 
  fig.height = 5,
  fig.align = 'center',
  fig.retina = 3)
set.seed(6)
options(digits = 5)
options(scipen = 999)
```

```{r include=FALSE}
library(tidyverse)
library(plotly)
library(lubridate)
library(chron)
library(kableExtra)
marathon <- read.csv("https://gist.githubusercontent.com/MikeLydeamore/6045b001ff01604841693192b337dd0b/raw/60d60e36923efa24dbff567a6b934f08a00ba77d/full_marathon_2008_2021.csv")
```

## Introduction \| Marathon {data-background="Image/image.png" data-background-size="120px" data-background-position="bottom" data-background-repeat="repeat-x"}

>-   Long distance race, 42.20km

>-  It is a road race & trial routes

>-   Each year, 800+ marathon events & Ten of thousands participants

>-   Name from Legend of Philippides

>-   Become one of Olympic events in 1896 

>-  length of marathon standardized in 1921

## Aim and motivation 

To :

-   Explore the completed full marathon data.

-   Perform an exploratory data analysis and focus on temporal changes.

-   E.g. How are the completion times for marathons changing between
    2008 and 2021?

## Data description\|

>-   Source : [RUNRACERESULT](https://www.runraceresults.com/)

>-   Collated all completed full-marathon from 2008 to 2021 in USA.

>-   `r scales::comma(nrow(marathon))` observations & `r ncol(marathon)`
    variables

-   Name, Age, Date of birth, Gender, Location etc...

-   Year, Place, Net time, Pace, Time in minutes etc...

## Questions of interest

1.  Demographics changes of marathon participants in United States from
    2008 to 2021. (Gender, age group, nationality)

2.  How are the completion times for marathons changing between 2008 and
    2021?

3.  How does the pace change for the participants from different age
    groups between 2008 and 2021?

4.  The relationship between age and time spend for marathon
    participants.

5.  Which gender group perform better?

## Analysis and findings\|

Q1. Demographics changes of marathon participants in United States from 2008 to 2021.

```{r out.width = "85%"}
gender <- marathon %>%
  select(year, sex) %>%
  group_by(year, sex) %>%
  summarise("total" = n())

p1 <- gender %>%
  ggplot(aes(x = year,
             y = total,
             fill = sex)) +
  geom_col(position = "dodge") +
  scale_fill_brewer("Gender", palette = "Set1") +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 0, hjust = 0), legend.position = "top") +
  labs(y = "Number of participants",
       x = "Year",
       title = "Gender",
       fill = "") 
```

<!-- ## Analysis and findings|Q1. Demographics changes of marathon participants in United States from 2008 to 2021. -->

<!-- ```{r out.width = "85%"} -->
<!-- marathon1 <- marathon -->

<!-- marathon1$category <- gsub("M ", "", marathon1$category) -->

<!-- marathon1$category <- gsub("F ", "", marathon1$category) -->

<!-- marathon1 <- marathon1 %>% -->
<!--   filter(category != "O 01-99") -->

<!-- age_group <- marathon1 %>% -->
<!--   select(year, category) %>% -->
<!--   group_by(year, category) %>% -->
<!--   summarise("total" = n()) -->

<!-- age_group %>% -->
<!--   ggplot(aes(x = year, -->
<!--              y = total)) + -->
<!--   geom_col(position = "dodge") + -->
<!--   scale_fill_brewer("Age group", palette = "Set1") + -->
<!--   theme_classic() + -->
<!--   theme(axis.text.x = element_text(angle = 0, hjust = 0), legend.position = "right" ) + -->
<!--   labs(y = "Total participants", -->
<!--        title = "Age group changes") + -->
<!--   facet_wrap(~ category, ncol = 4) -->
<!-- ``` -->

<!-- ## Analysis and findings|Q1. Demographics changes of marathon participants in United States from 2008 to 2021. -->

```{r out.width = "85%"}
nation <- marathon %>%
  select(year, country) %>%
  group_by(year, country == "USA") %>%
  summarise("total" = n()) %>%
  rename("nation" = 'country == "USA"')

p2 <- nation %>%
  ggplot(aes(x = year,
             y = total,
             fill = nation)) +
  geom_col(position = "dodge") +
  scale_fill_brewer("USA", palette = "Set3") +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 0, hjust = 0), legend.position = "top") +
  scale_fill_discrete(labels=c("Foreigner", "Resident")) +
  labs(y = "Number of participants",
       x = "Year",
       title = "Nationality",
       fill = "") 
```

```{r out.width='90%'}
gridExtra::grid.arrange(p1,p2,ncol = 2)
```

## Analysis and findings|Q2. How are the completion times for marathons changing between 2008 and 2021?

```{r}
# box plots
q_21 <- marathon %>%
  mutate(year = as.character(year),
         place = as.character(place))

p21 <- q_21 %>%
  ggplot(aes(x = year, y = time_mins, group = year, color = year)) +
  geom_boxplot() +
  labs(x = "Year", y = "Completion times (in minutes)") +
  ggtitle("Boxplot of the completion times for marathons between 2008 and 2021") +
  theme(legend.position="none")

p21
```

## Analysis and findings|Q2. How are the completion times for marathons changing between 2008 and 2021?

```{r}
q_22 <- q_21 %>%
  filter(place == "1")
q_22$category <- gsub("M ", "", q_22$category)
q_22$category <- gsub("F ", "", q_22$category)
q_22 <- q_22 %>%
  rename("age_group" = "category")

p23 <- q_22 %>%
  ggplot(aes(x = year, y = time_mins, group = 1)) +
  geom_line() +
  geom_point(aes(color = age_group), size = 3) +
  geom_text(data = q_22, aes(y = time_mins + 0.3, label = name), size = 2.2)  +
  labs(x = "Year", y = "Completion times (in minutes)") +
  ggtitle("The best completion times for marathons between 2008 and 2021") +
  theme_bw()

p23
```

## Analysis and findings|Q3. How does the pace change for the participants from different age groups between 2008 and 2021?

```{r}
q_3 <- marathon %>%
  mutate(year = as.character(year),
         place = as.character(place)) %>%
  filter(category != "O 01-99") %>%
  rename("age_group" = "category")

q_3$age_group <- gsub("M ", "", q_3$age_group)
q_3$age_group <- gsub("F ", "", q_3$age_group)

q_3 <- q_3 %>%
  mutate(pace = as.difftime(pace, format = "%M:%S")) %>%
  mutate(pace = as.numeric(pace))

p31 <- q_3 %>%
  group_by(age_group, year) %>%
  summarise(mean_pace = mean(pace)) %>%
  ggplot(aes(x = year, y = mean_pace, group = 1)) +
  geom_line() +
  geom_point() +
  facet_wrap(~ age_group) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(x = "Year", y = "Mean pace") +
  ggtitle("The average pace of the participants from different age groups between 2008 and 2021")

p31
```

## Analysis and findings|Q3. How does the pace change for the participants from different age groups between 2008 and 2021?

```{r}
p32 <- q_3 %>%
  filter(age_group != "NoAge") %>%
  group_by(age_group, year) %>%
  summarise(mean_pace = mean(pace)) %>%
  ggplot(aes(x = year, y = mean_pace, group = 1)) +
  geom_line(aes(group = age_group, color = age_group)) +
  geom_point(aes(group = age_group, color = age_group)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(x = "Year", y = "Mean pace") +
  ggtitle("The average pace of the participants from different age groups between 2008 and 2021")

p32
```

## Analysis and findings\|Something interesting from Q3.

```{r}
t31 <- q_3 %>%
  filter(year == "2019") %>%
  filter(age_group == "80-99") %>%
  select(year, name, pace, sex, age, birth, place)

t31
```

## Analysis and findings\| Q4. The relationship between age and time spend for marathon participants.

> - Observations gathering and no regular distribution
> - Seems no obvious relationship 

```{r}
q41 <- marathon %>% 
  select(year, age, time_mins, pace, sex)  %>% 
  mutate(pace = as.difftime(pace, format = "%M:%S")) %>%
  mutate(pace = as.numeric(pace)) %>% 
  filter(age >15)

q41 %>%  ggplot(aes(x = age, y = time_mins)) +
         geom_point(aes(col= sex), alpha = 0.3) +
         labs(x = "Age", y ="Marathon completion time (in minutes)") + 
         ggtitle("Age VS Mrathon completion time")


```

## Analysis and findings\| Q4. The relationship between age and time spend for marathon participants.

> - Positive relationship between age group and completion time
> - Exponential relationship

```{r}

q42 <- marathon %>%
  filter(age > 10) %>% 
  mutate(year = as.character(year),
         place = as.character(place)) %>%
  filter(category != "10-99") %>%
  rename("age_group" = "category")

q42$age_group <- gsub("M ", "", q42$age_group)
q42$age_group <- gsub("F ", "", q42$age_group)

##unique(q42$age_group)


p42 <- q42 %>% 
  select(year, age_group, time_mins, pace, sex) %>% 
  filter(!age_group == "NoAge" & !age_group=="O 01-99") %>% 
  group_by(age_group,sex) %>% 
  summarise(avg_time = mean(time_mins))%>%  
   ggplot(aes(x = age_group, y = avg_time)) +
         geom_point(aes(col= sex)) +
         labs(x = "Age group", y ="Average completion time (in minutes)") + 
         ggtitle("Age group VS Marathon average completion time")
 
p42

```

## Analysis and findings|Q4. The relationship between age and time spend for marathon participants.

> - Generally as people become older, they will take longer time to complete marathons.  

```{r}

q42_sct<- q42 %>%  
        select(year, age_group, time_mins, pace, sex) %>% 
        mutate(pace = as.difftime(pace, format = "%M:%S")) %>%
        mutate(pace = as.numeric(pace))  
        


GGally::ggpairs(q42_sct, 
                aes(col = sex),
                columns = 2:4, cardinality_threshold=NULL) 
```


## Analysis and findings|Q5. Which gender group perform better? 

> - Female participants spend longer time than male participants
> - Completion time increased from 2013 to 2017

```{r}
time_df <- marathon %>% 
  select(year, time_mins, sex) 

time_tbl <- time_df %>%  
  group_by(year, sex) %>%  
  summarise(avg_time = mean(time_mins)) 

p5<-time_tbl %>% ggplot(aes(x = year, y = avg_time)) +
             geom_point(aes(col= sex), alpha = 0.5) + 
             geom_line(aes(col = sex)) + 
             labs(x = "Year", y = "Average completion times(in minutes)") +
             ggtitle("Average completion times for marathons between 2008 and 2021")
p5
```



## Conclusion

> - Biggest demographic change in 2021 because of the COVID
> - 2010 and 2018 performed better than the other year
> - 2013 to 2017 has an increasing trend for the completion time
> - Positive relationship between each age group and average completion time
> - Male perform better than female 



## Reference

Wickham H, Averick M, Bryan J, Chang W, McGowan LD, François R,
Grolemund G, Hayes A, Henry L, Hester J, Kuhn M, Pedersen TL, Miller E,
Bache SM, Müller K, Ooms J, Robinson D, Seidel DP, Spinu V, Takahashi K,
Vaughan D, Wilke C, Woo K, Yutani H (2019). "Welcome to the tidyverse."
*Journal of Open Source Software*, *4*(43), 1686. doi:
10.21105/joss.01686 (URL: <https://doi.org/10.21105/joss.01686>).

C. Sievert. Interactive Web-Based Data Visualization with R, plotly, and
shiny. Chapman and Hall/CRC Florida, 2020.

Garrett Grolemund, Hadley Wickham (2011). Dates and Times Made Easy with
lubridate. Journal of Statistical Software, 40(3), 1-25. URL
<https://www.jstatsoft.org/v40/i03/>.

David James and Kurt Hornik (2022). chron: Chronological Objects which
Can Handle Dates and Times. R package version 2.3-58.

Hao Zhu (2021). kableExtra: Construct Complex Table with 'kable' and
Pipe Syntax. R package version 1.3.4.
<https://CRAN.R-project.org/package=kableExtra>

RUN RACE RESULT: <https://www.runraceresults.com/>.

## {data-background="Image/happy.webp" data-background-position="bottom" data-background-repeat="repeat-x"}
